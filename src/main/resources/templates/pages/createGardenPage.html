<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://thymeleaf.org">

<head th:replace="~{fragments/head :: head(title='Gardener\'s Grove - Create Garden')}"></head>

<body>
    <div th:replace="~{fragments/header :: header}"></div>
    <main>
        <div class="content">
            <h1>Create a garden</h1>
            <form th:action="@{/gardens/create}" method="post" th:object="${createGardenForm}">
                <input th:replace="~{fragments/formElement :: formElementField(fieldName='name', label='Garden Name: ', placeholder='The Hamilton Gardens')}" />
                <br />
                <input th:replace="~{fragments/formElement :: formElementField(fieldName='size', label='Size in m&sup2; (optional): ', placeholder='540000.0')}" />

                <h2>Garden Location</h2>
                <input id="address" th:replace="~{fragments/formElement :: formElementField(fieldName='address', label='Address: (optional)', placeholder='13 Hungerford Crescent')}" />
                <br />
                <input th:replace="~{fragments/formElement :: formElementField(fieldName='suburb', label='Suburb: (optional)', placeholder='Ilam')}" />
                <br />
                <input th:replace="~{fragments/formElement :: formElementField(fieldName='city', label='City: ', placeholder='Christchurch')}" />
                <br />
                <input th:replace="~{fragments/formElement :: formElementField(fieldName='postcode', label='Postcode: (optional)', placeholder='3216')}" />
                <br />
                <input th:replace="~{fragments/formElement :: formElementField(fieldName='country', label='Country: ', placeholder='New Zealand')}" />
                <br />

                <p>Search by <a href="https://locationiq.com">LocationIQ.com</a></p>
                <button class="next" type="submit">Create</button>
                <a class="cancel button" th:href="@{/gardens}">Cancel</a> <!--TODO cancel back to the previous page-->
            </form>
        </div>
    </main>
    <script>
        // ChatGPT is helping out a bit here, I haven't used fetch much before.

        let timeoutId;

        function debounce(func, delay) {
            clearTimeout(timeoutId);
            timeoutId = setTimeout(func, delay);
        }

        // Assuming you have a function to send the API request called sendRequest
        function sendRequest() {
            // Your API request logic here
            console.log("send");
            const query = searchInput.value;
            const addressField = "street address"; // Or get this dynamically based on user selection

            fetch(`/locationSearch?query=${query}&addressField=${addressField}`)
                .then(response => response.json())
                .then(locations => {
                    // Update autocomplete suggestions with the received locations
                    console.log(locations);
                })
                .catch(error => {
                    console.error('Error fetching locations:', error);
                });
        }

        // Assuming you have an event listener on your search input field
        const searchInput = document.getElementById('address');
        searchInput.addEventListener('input', () => {
            debounce(sendRequest, 500);
        });
    </script>
</body>
</html>